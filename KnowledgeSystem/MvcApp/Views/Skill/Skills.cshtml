@using MvcApp.Infrastructure;
@model MvcApp.ViewModels.GenericPaginationModel<MvcApp.ViewModels.MvcCategory>

@{
    ViewBag.Title = "Skills";
}
@using (Html.BeginForm())
{
    <h2>Skills</h2>
    <div class="form-group">
        <div class="col-md-10">
            <input type="text" class="form-control" name="FindSkill" placeholder="Find Skill" value=@ViewBag.FindSkill>
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-10">
            <select class="form-control" name="FindCategory">
                <option data-hidden="true"></option>
                @for (int j = 0; j < ViewBag.Categories.Count; j++)
                {
                    if (ViewBag.AdditionalSearchString == @ViewBag.Categories[j])
                    {
                        <option selected>@ViewBag.Categories[j]</option>
                    }
                    else
                    {
                        <option>@ViewBag.Categories[j]</option>
                    }
                }
            </select>
        </div>
    </div>
    <div class="form-group col-md-2">
        <input type="submit" value="Find" class="btn btn-default" />
    </div>

    for (int j = 0; j < Model.Entities.Count; j++)
			{
        <h3>@Model.Entities[j].Name</h3>
			<table class="table table-striped">
        <thead>
        <th></th>
        <th>
            Skill
        </th>
        <th>
            Category
        </th>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Entities[j].Skills.Count; i++)
            {
                <tr>
                    <td>
                        @Html.HiddenFor(x => Model.Entities[j].Skills[i].Id)
                    </td>
                    <td>
                        @Html.HiddenFor(x => Model.Entities[j].Skills[i].Name)
                        @Html.DisplayFor(x => Model.Entities[j].Skills[i].Name)
                    </td>
                    <td>
                        @Html.HiddenFor(x => Model.Entities[j].Skills[i].CategoryName)
                    </td>
                    @{
                        var identity = (CustomIdentity)User.Identity;

                        if (identity.Roles.FirstOrDefault(r => r == "Administrator") != null)
                        {
                            <td>
                                @Html.RouteLink("Edit", new { controller = "Skill", action = "EditSkill", id = Model.Entities[j].Skills[i].Id })
                            </td>
                            <td>
                                @Html.RouteLink("Remove", new { controller = "Skill", action = "RemoveSkill", id = Model.Entities[j].Skills[i].Id })
                            </td>
                        }
                    }
                </tr>
                        }
        </tbody>
    </table> 
			}

    <div class="btn-group">
        @Html.PageSubmit(Model.Pagination)
    </div>
    <div>
        @Html.ActionLink("Create skill", "CreateSkill", "Skill")
    </div>
                        }