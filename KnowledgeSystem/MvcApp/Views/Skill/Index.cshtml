@using MvcApp.Infrastructure;
@model MvcApp.ViewModels.GenericPaginationModel<MvcApp.ViewModels.MvcCategory>

@{
    ViewBag.Title = "Skills";
}

@using (Html.BeginForm())
{
    for(int i=0;i<Model.Entities.Count;i++)
    //foreach (var item in Model.Entities)
    {
        <div>
            @Model.Entities[i].Name
            @Html.HiddenFor(Model => Model.Entities[i].Id)
            @Html.HiddenFor(Model => Model.Entities[i].Name)
            <table class="table">
                @for(int j=0;j<Model.Entities[i].Skills.Count;j++)
                //@foreach (var skill in item.Skills)
                {
                    <tr>
                        <td>
                            @Html.HiddenFor(Model => Model.Entities[i].Skills[j].Id)
                        </td>
                        <td>
                            @Html.HiddenFor(Model => Model.Entities[i].Skills[j].Name)
                            @Html.DisplayFor(Model => Model.Entities[i].Skills[j].Name)
                        </td>
                        <td>
                            @{string name = "Entities["+i+"].Skills["+ j +"].Level";
                            }
                            <input for="Level" id="@Model.Entities[i].Skills[j].Id" value="@Model.Entities[i].Skills[j].Level" name="@name" class="rating-loading" data-size="xs" data-min="0" data-max="5" data-step="1" data-show-clear="false">
                        </td>
                    </tr>
                                }
            </table>
        </div>
                                }
                                <div class="btn-group">
                                    @Html.PageSubmit(Model.Pagination)
                                </div>
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <input id="submit" type="submit" value="Update" class="btn btn-default" />
                                    </div>
                                </div>
                                }
@*@using (Html.BeginForm())
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>
                    Skill
                </th>
                <th>
                    Category
                </th>
                <th>
                    Level
                </th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Entities.ToArray().Length; i++)
                {
                <tr>
                    <td>
                        @Html.HiddenFor(Model => Model.Entities[i].Id)
                    </td>
                    <td>
                        @Html.HiddenFor(Model => Model.Entities[i].Name)
                        @Html.DisplayFor(Model => Model.Entities[i].Name)
                    </td>
                    <td>
                        @Html.HiddenFor(Model => Model.Entities[i].CategoryName)
                        @Html.DisplayFor(Model => Model.Entities[i].CategoryName)
                    </td>
                    <td>
                        @{string name = "Entities[" + i + "].Level";
                        }
                        <input for="Level" id="@Model.Entities[i].Id" value="@Model.Entities[i].Level" name="@name" class="rating-loading" data-size="xs" data-min="0" data-max="5" data-step="1" data-show-clear="false">
                    </td>
                </tr>
                            }
        </tbody>
        </table>
        <div class="btn-group">
            @Html.PageSubmit(Model.Pagination)
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input id="submit" type="submit" value="Update" class="btn btn-default" />
            </div>
        </div>
                            }*@

@section scripts{
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css" rel="stylesheet">
    <link href="~/Content/star-rating.css" media="all" rel="stylesheet" type="text/css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
    <script src="~/Scripts/star-rating.js" type="text/javascript"></script>
    @foreach (var item in Model.Entities)
    {
        foreach (var skill in item.Skills)
        {
            string id = skill.Id.ToString();
            <script>
            $(document).on('ready', function () {
                $('#@id').rating({
                    step: 1,
                    defaultCaption: ' ',
                    starCaptions: { 1: '', 2: '', 3: '', 4: '', 5: '' },
                    starCaptionClasses: function (val) { return 'text-success'; }
                }).on('rating.change', function (event, value, caption) {
                    Model.Skills.FirstOrDefault(s => s.Key.Id.ToString() == id).Value = value;
                });
            });
            </script>
        }

    }
}
