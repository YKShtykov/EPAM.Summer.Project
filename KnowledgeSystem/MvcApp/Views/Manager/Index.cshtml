@using MvcApp.Infrastructure;
@model MvcApp.ViewModels.GenericPaginationModel<MvcApp.ViewModels.SkillsModel>


@{
    ViewBag.Title = "Index";
    int skillsCount = ViewBag.Skills.Length;
}
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div id="result"></div>
            </div>
        </div>
    </div>
</div>

<h2>Index</h2>
@using (Html.BeginForm())
{
    <div id="content">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>User Login</th>
                    @for (int i = 0; i < ViewBag.Skills.Length; i++)
                {
                        <th>
                            @{string id = "select" + i;
                            }
                            <select class="form-control" id="@id" name="selector">
                                @for (int j = 0; j < ViewBag.AllSkills.Length; j++)
                                {
                                    if (ViewBag.Skills[i] == ViewBag.AllSkills[j])
                                    {
                                        <option selected>@ViewBag.AllSkills[j]</option>
                                    }
                                    else
                                    {
                                        <option>@ViewBag.AllSkills[j]</option>
                                    }
                                }
                            </select>
                        </th>
                                }
                    @if (skillsCount < 5)
                {
                    for (int i = 0; i < 5 - skillsCount; i++)
                    {
                            <th>
                                <select class="form-control" name="selector">
                                    <option data-hidden="true"></option>
                                    @foreach (var option in ViewBag.AllSkills)
                                    {
                                        <option>@option</option>

                                    }
                                </select>
                            </th>

                        }
                    }
                </tr>

            </thead>
            <tbody>
                @foreach (var item in Model.Entities)
                {
                    <tr>
                        <td>@Html.ActionLink(item.UserLogin, "UserDetails","Administrator", new { id = item.UserId }, null)</td>
                        @foreach (var item2 in item.Skills)
                        {
                            <td>@item2.Level</td>
                        }
                    </tr>

                }
            </tbody>
        </table>
    </div>
    <div class="btn-group">
        @Html.PageSubmit(Model.Pagination)
    </div>

    <div id="page-selection"></div>
    <div class="form-group col-md-2">
        <input type="submit" value="Save" class="btn btn-default" />
    </div>
}

@section scripts{
<link rel="stylesheet" href="~/Content/bootstrap-select.css">
<script src="~/Scripts/bootstrap-select.js"></script>
<script type="text/javascript" src="~/scripts/jsrender.js"></script>

<script id="UserTemplate" type="text/x-jsrender">
    <div class="row">
        <p><em>FName:</em> {{:FirstName}}</p>
        <p><em>MName:</em> {{:MiddleName}}</p>
        <p><em>LName:</em> {{:LastName}}</p>
        <p><em>Age</em>{{:Age}}</p>
        <a href="~/Controllers/SkillController.cs">Profile</a>
        Html.RouteLink("Skills", new { controller = "Skill", action = "UserSkills", id = Id })
    </div>
</script>

<script>
            $(document).ready(function () {
                $("td a").click(function (e) {
                        e.preventDefault();
                        var url = $(this).attr('href');
                    $.getJSON(url, null, function (user) {
                            var template = $.templates("#UserTemplate");
                            var htmlOutput = template.render(user);
                        $('#myModal').modal('show');
                        $("#result").html(htmlOutput);
                        });
                    });
            });
</script>
}